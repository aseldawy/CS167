<!DOCTYPE html>
<html>

<head>
    <title>CS167-Lab7.md</title>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    
<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

html,footer,header{
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Custom MD PDF CSS
 */
html,footer,header{
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";

 }
body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>
<link rel="stylesheet" href="file:///Users/huangbo/Documents/PhD-Related/Winter2025/CS167/R%3A%5C2.Travail%5C1.Enseignement%5CCours%5C_1.Outils%5C2.Developpement%5C1.SCSS%5Cmain.css" type="text/css"><link rel="stylesheet" href="file:///Users/huangbo/Documents/PhD-Related/Winter2025/CS167/D%3A%5Crdaros%5CCours%5C_1.Outils%5C2.Developpement%5C1.SCSS%5Cmain.css" type="text/css">
</head>

<body>
    <h1 id="lab-7">Lab 7</h1>
<h2 id="objectives">Objectives</h2>
<ul>
<li>Understand the document database model.</li>
<li>Manipulate a set of documents in a database.</li>
<li>Understand how MongoDB deals with the flexibility of the document data model.</li>
</ul>
<hr>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Download the following sample file <a href="./tweets.json">tweets.json</a>.</li>
<li>Access to your cs167 machine.</li>
</ul>
<hr>
<h2 id="lab-work">Lab Work</h2>
<h3 id="i-setup-mongodb-database-tools-and-mongodb-shell-in-your-cs167-machine-15-minutes-in-home">I. Setup MongoDB, Database Tools and MongoDB shell in your cs167 machine (15 minutes, In-home)</h3>
<ol>
<li>Login to your CS167 machine.</li>
<li>On your CS167 machine, download and extract <code>MongoDB Community Edition</code> with version <code>8.0.4</code> to your <code>$HOME/cs167</code> using the command below:<pre class="hljs"><code><div>curl https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu2204-8.0.4.tgz | tar -xvz -C $HOME/cs167
</div></code></pre>
</li>
<li>Download and extract <code>MongoDB Database Tools</code> with version <code>100.11.0</code> to your $HOME/cs167 using the command below:<pre class="hljs"><code><div>curl https://fastdl.mongodb.org/tools/db/mongodb-database-tools-ubuntu2204-x86_64-100.11.0.tgz | tar -xvz -C $HOME/cs167
</div></code></pre>
</li>
<li>Download and extract <code>MongoDB Shell</code> with version <code>2.3.9</code> to your $HOME/cs167 using the command below:<pre class="hljs"><code><div>curl https://downloads.mongodb.com/compass/mongosh-2.3.9-linux-x64.tgz | tar -xvz -C $HOME/cs167
</div></code></pre>
</li>
</ol>
<p><em>Note:</em> You should see the following three folders created in your <code>$HOME/cs167</code> folder after step 4:</p>
<ul>
<li>mongodb-linux-x86_64-ubuntu2204-8.0.4</li>
<li>mongodb-database-tools-ubuntu2204-x86_64-100.11.0</li>
<li>mongosh-2.3.9-linux-x64</li>
</ul>
<ol start="5">
<li>Use the following command to copy all the files from the <code>~/cs167/mongodb-database-tools-ubuntu2204-x86_64-100.11.0/bin</code> directory to the <code>~/cs167/mongodb-linux-x86_64-ubuntu2204-8.0.4/bin</code> directory:<pre class="hljs"><code><div>cp -r $HOME/cs167/mongodb-database-tools-ubuntu2204-x86_64-100.11.0/bin/* $HOME/cs167/mongodb-linux-x86_64-ubuntu2204-8.0.4/bin/
</div></code></pre>
</li>
</ol>
<!-- Available files are:
    + bsondump
    + mongoexport
    + mongoimport
    + mongostat
    + mongodump
    + mongofiles
    + mongorestore
    + mongotop -->
<ol start="6">
<li>Use the following command to copy all the files from  the <code>~/cs167/mongosh-2.3.9-linux-x64/bin</code> directory to the <code>~/cs167/mongodb-linux-x86_64-ubuntu2204-8.0.4/bin</code> directory.<pre class="hljs"><code><div>cp -r $HOME/cs167/mongosh-2.3.9-linux-x64/bin/* $HOME/cs167/mongodb-linux-x86_64-ubuntu2204-8.0.4/bin/
</div></code></pre>
</li>
</ol>
<!-- Available files are:
    + mongosh 
    + mongosh_crypt_v1.so -->
<ol start="7">
<li>
<p>Setup <code>environment variables</code> for MongoDB using the following command:</p>
<pre class="hljs"><code><div>echo 'export MONGODB_HOME=$HOME/cs167/mongodb-linux-x86_64-ubuntu2204-8.0.4' &gt;&gt; ~/.bashrc
echo 'export PATH=$PATH:$MONGODB_HOME/bin' &gt;&gt; ~/.bashrc
</div></code></pre>
</li>
<li>
<p>Reload the configuration by running:</p>
<pre class="hljs"><code><div>source ~/.bashrc
</div></code></pre>
</li>
<li>
<p>Test that MongoDB works correctly by running the command:</p>
<pre class="hljs"><code><div>mongod -version
</div></code></pre>
<p>The output should look something like the following:</p>
<pre class="hljs"><code><div>db version v8<span class="hljs-number">.0</span><span class="hljs-number">.4</span>
Build Info: {
    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"8.0.4"</span>,
    <span class="hljs-attr">"gitVersion"</span>: <span class="hljs-string">"bc35ab4305d9920d9d0491c1c9ef9b72383d31f9"</span>,
    <span class="hljs-attr">"openSSLVersion"</span>: <span class="hljs-string">"OpenSSL 3.0.2 15 Mar 2022"</span>,
    <span class="hljs-attr">"modules"</span>: [],
    <span class="hljs-attr">"allocator"</span>: <span class="hljs-string">"tcmalloc-google"</span>,
    <span class="hljs-attr">"environment"</span>: {
        <span class="hljs-attr">"distmod"</span>: <span class="hljs-string">"ubuntu2204"</span>,
        <span class="hljs-attr">"distarch"</span>: <span class="hljs-string">"x86_64"</span>,
        <span class="hljs-attr">"target_arch"</span>: <span class="hljs-string">"x86_64"</span>
    }
}
</div></code></pre>
</li>
<li>
<p>Use the following command to create a <code>$MONGODB_HOME/data</code> directory where your data will be stored:</p>
<pre class="hljs"><code><div>mkdir -p $MONGODB_HOME/data
</div></code></pre>
</li>
<li>
<p>Start the <code>MongoDB server</code> by running the following command in <code>screen</code> or <code>tmux</code>, or <code>keep the tab/window open</code> while doing this lab:</p>
<pre class="hljs"><code><div>mongod --dbpath $MONGODB_HOME/data
</div></code></pre>
</li>
</ol>
<!-- *Note*: It is recommended to run the **mongod** service in a [screen](../../remote-access.md#part-vii-run-commands-in-a-screen) so it stays running in case you lose your connection. If this is too complicated for you, just keep the window open. If you get disconnected, you will need to rerun the **mongod** service again using the command above. -->
<h3 id="ii-data-understanding-15-minutes---in-home">II. Data Understanding (15 minutes - In Home)</h3>
<p>In this part, you will work with the <a href="tweets.json"><code>tweets.json</code></a> file to better understand it.</p>
<ol>
<li>
<p>Upload <a href="./tweets.json"><code>tweets.json</code></a> to your <code>cs167</code> virtual machine home directory (you can drag the file into <code>vscode</code> if you are connecting with <code>cs167</code> by <code>vscode</code>).</p>
</li>
<li>
<p>On your <code>cs167 machine</code>, start a new <code>Spark shell in local mode</code> by running:</p>
<pre class="hljs"><code><div>spark-shell --master local
</div></code></pre>
<p>Wait a few seconds, you should be able to see the following information:</p>
<pre class="hljs"><code><div>Spark context Web UI available at http://class-###.cs.ucr.edu:4040
Spark context available as 'sc' (master = local, app id = local-1739417507414).
Spark session available as 'spark'.
Welcome to
    ____              __
    / __/__  ___ _____/ /__
    _\ \/ _ \/ _ `/ __/  '_/
/___/ .__/\_,_/_/ /_/\_\   version 3.5.4
    /_/
        
Using Scala version 2.12.18 (Java HotSpot(TM) 64-Bit Server VM, Java 17.0.12)
Type in expressions to have them evaluated.
Type :help for more information.
<span class="hljs-meta">
scala&gt;</span><span class="bash"> </span>
</div></code></pre>
</li>
<li>
<p>Once the Spark shell starts, run the command:</p>
<pre class="hljs"><code><div>spark.read.json("file:///home/cs167/tweets.json").printSchema
</div></code></pre>
<p><em>Note</em>: We explicitly use the local file system (<code>file:///</code>) to override your existing configuration from previous labs.</p>
</li>
</ol>
<ul>
<li><em><strong>(Q1) What is the schema of the file? Copy it to the README file and keep it for your reference.</strong></em></li>
</ul>
<ol start="4">
<li>Leave <code>spark-shell</code> by tapping:<pre class="hljs"><code><div>:q
</div></code></pre>
</li>
</ol>
<hr>
<h3 id="iii-data-manipulation-60-minutes">III. Data Manipulation (60 minutes)</h3>
<p>For this part, you can use <code>generative AI tools</code> to help you get familiar with <code>MongoDB</code> interfaces. Attach your conversation in your submission for grading.</p>
<ol>
<li>Start a new terminal on your <code>cs167 machine</code>, import the sample file into a new collection named <code>tweets</code>. You will need to use <a href="https://www.mongodb.com/docs/database-tools/mongoimport/"><code>mongoimport</code></a> command from the database tool with <a href="https://www.mongodb.com/docs/database-tools/mongoimport/#std-option-mongoimport.--collection"><code>--collection</code></a> option.</li>
</ol>
<ul>
<li><em><strong>(Q2) What is your command to import the <code>tweets.json</code> file?</strong></em></li>
<li><em><strong>(Q3) What is the output of the import command?</strong></em></li>
</ul>
<ol start="2">
<li>
<p>On your CS167 machine, start a <code>MongoDB Shell</code> by running the command:</p>
<pre class="hljs"><code><div>mongosh
</div></code></pre>
<p>You should see the following content:<br>
<img src="file:///Users/huangbo/Documents/PhD-Related/Winter2025/CS167/Labs/Lab7/images/mongosh-terminal.png" alt="Mongo Shell"></p>
<p><code>MongoDB Shell</code> is an <code>interactive JavaScript interface</code> to MongoDB. Here, you can run queries, manage data, and perform administrative tasks directly in your MongoDB database.</p>
</li>
<li>
<p>You can use the following command to list all available <code>MongoDB</code> databases:</p>
<pre class="hljs"><code><div>show dbs
</div></code></pre>
<p>And use the following command to switch to the db you store <code>tweets</code>:</p>
<pre class="hljs"><code><div>use [db name]
</div></code></pre>
</li>
<li>
<p>Write a query in the MongoDB shell to count the total number of records in the <code>tweets</code> collection.</p>
</li>
</ol>
<ul>
<li><em><strong>(Q4) What is your command to count the total number of records in the <code>tweets</code> collection and what is the output of the command?</strong></em></li>
</ul>
<ol start="5">
<li>Find all tweets those have <code>country_code</code> &quot;JP&quot; and user's <code>statuses_count</code> is greater than 50,000. From these tweets, list information about the users, specifically their username (<code>user_name</code>), number of followers (<code>followers_count</code>), and total number of tweets (<code>statuses_count</code>). The results should be sorted in <em>ascending order</em> based on the number of followers (<code>followers_count</code>).</li>
</ol>
<ul>
<li>
<p><em><strong>(Q5) What is your command for this query?</strong></em></p>
</li>
<li>
<p><em><strong>(Q6) How many records does your query return?</strong></em> (Use the <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.count/">db.collection.count()</a> function to answer this question.)</p>
<p>Hint: You can <code>provide the AI tools with some sample data</code> so that it can better understand the data format. You will need to use <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.find/#mongodb-method-db.collection.find">db.collection.find()</a>, <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.find/#projection">projection</a> and <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.sort/#ascending-descending-sort">Ascending/Descending Sort</a>. Check how to <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.find/#embedded-field-specification">access nested attributes</a>.</p>
</li>
</ul>
<ol start="5">
<li>Repeat what you did for Q5 but <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.find/#_id-field-projection">do not show the <code>_id</code> field</a>.</li>
</ol>
<ul>
<li><em><strong>(Q7) What is the command that retrieves the results without the _id field?</strong></em></li>
</ul>
<ol start="6">
<li>Insert the following document into the collection.<pre class="hljs"><code><div>{id: Long('<span class="hljs-number">921633456941125634</span>'), place: { country_code: 'JP', name: 'Japan', place_type: 'city' }, user: {user_name: 'xyz2', followers_count: [<span class="hljs-number">2100</span>, <span class="hljs-number">5000</span>], statuses_count: <span class="hljs-number">55000</span>}, hashtags: ['nature' ],lang: 'ja'}
</div></code></pre>
</li>
</ol>
<ul>
<li>
<p><em><strong>(Q8) What is the command to insert the sample document? What is the result of running the command?</strong></em></p>
</li>
<li>
<p><em><strong>(Q9) Does MongoDB accept this document while the followers_count field has a different type than other records?</strong></em></p>
<p>Hint: Use <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.insertOne/#db.collection.insertone--"><code>db.collection.insertOne()</code></a>.</p>
</li>
</ul>
<ol start="7">
<li>
<p>Insert the following document into the collection.</p>
<pre class="hljs"><code><div>{id: Long('<span class="hljs-number">921633456941121354</span>'), place: { country_code: 'JP', name: 'Japan', place_type: 'city' }, user: {user_name: 'xyz3', followers_count: {last_month: <span class="hljs-number">550</span>, this_month: <span class="hljs-number">2200</span>}, statuses_count: <span class="hljs-number">112000</span>}, hashtags: [ 'art', 'tour' ], lang: 'ja'
}
</div></code></pre>
</li>
</ol>
<ul>
<li><em><strong>(Q10) What is your command to insert this record?</strong></em></li>
</ul>
<ol start="8">
<li>Now go back to step 5, which lists the records in Japan and with followers larger than 50,000. This time, sort the results by followers_count in <strong>descending</strong> order.</li>
</ol>
<ul>
<li>
<p><em><strong>(Q11) Where did the two new records appear in the sort order?</strong></em></p>
<ul>
<li>Note: write the answer in the form: user name &quot;xyz2&quot; is the first/last/or between followers_count {} and {}. user name &quot;xyz3&quot; is the first/last/or between followers_count {} and {}.</li>
</ul>
</li>
<li>
<p><em><strong>(Q12) Why did they appear at these specific locations?</strong></em></p>
<p>Check the <a href="https://www.mongodb.com/docs/v6.2/reference/bson-type-comparison-order/">documentation of MongoDB</a> to help you answer this question.</p>
</li>
</ul>
<ol start="9">
<li>Now go back to step 5, but this time lists the records sorted by followers_count in <strong>ascending</strong> order.</li>
</ol>
<ul>
<li>
<p><em><strong>(Q13) Where did the two records appear in the ascending sort order? Explain your observation.</strong></em></p>
<p>Hint: <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.sort/#ascending-descending-sort">Ascending/Descending Sort</a>.</p>
</li>
</ul>
<ol start="10">
<li>Build an index on the <code>user.followers_count</code> field for the <code>tweets</code> collection.</li>
</ol>
<ul>
<li>
<p><em><strong>(Q14) Is MongoDB able to build the index on that field with the different value types stored in the <code>user.followers_count</code> field?</strong></em></p>
</li>
<li>
<p><em><strong>(Q15) What is your command for building the index?</strong></em></p>
</li>
<li>
<p><em><strong>(Q16) What is the output of the create index command?</strong></em></p>
<p>Hint: Use <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.createIndex/#mongodb-method-db.collection.createIndex"><code>db.collection.createIndex()</code></a>.</p>
</li>
</ul>
<hr>
<h3 id="iv-identify-tweets-with-selected-hashtags">IV.  Identify Tweets with Selected Hashtags</h3>
<p>In this part, you need to find all tweets that include any of the following hashtags: 'job', 'hiring', or 'IT'. The query should return the tweet text (text field), the associated hashtags, and the associated user's user_name, followers_count for each matching document in the <strong>ascending</strong> order of user's follower's count.</p>
<ul>
<li><em><strong>(Q17) What is your command for this query?</strong></em></li>
<li><em><strong>(Q18) How many records are returned from this query?</strong></em></li>
</ul>
<p><em>Hint:</em> : Use the <a href="https://www.mongodb.com/docs/manual/reference/operator/query/in/"><code>$in</code></a> operator within your query to specify that you want to find documents where the hashtags array contains at least one of the specified hashtags.</p>
<hr>
<h3 id="v-print-top-5-countries-with-most-number-of-tweets">V. Print top 5 countries with most number of tweets</h3>
<p>For this part, you need to run a query on <code>tweets</code> collection which will return the top 5 countries with most number of tweets. List the country_code and tweets_count in the descending order of the tweets_count. Use the <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.aggregate/#db.collection.aggregate--">db.collection.aggregate()</a> framework stages to group documents by the country code, count the number of tweets for each country, sort these counts, and then limit the results to only the top 5 countries.</p>
<ul>
<li><em><strong>(Q19) What is your command for this query?</strong></em></li>
<li><em><strong>(Q20) What is the output of the command?</strong></em></li>
</ul>
<hr>
<h3 id="vi-print-the-top-5-trending-hashtags-from-tweets">VI. Print the Top 5 Trending Hashtags from Tweets</h3>
<p>Write a MongoDB aggregation pipeline to determine the top 5 most frequently used hashtags in the tweets collection. The results should be sorted by the frequency of each hashtag in descending order.</p>
<ul>
<li>Begin by breaking down the array of hashtags so each one can be analyzed individually. Use <a href="https://www.mongodb.com/docs/manual/reference/operator/aggregation/unwind/"><code>$unwind</code></a> on the <code>hashtags</code> column in the aggregate pipeline.</li>
<li>Then, group by <code>hashtags</code>, count the occurrences of each, and order the results to find the most common hashtags. Finally, limit the output to show only the top 5 hashtags.</li>
</ul>
<ul>
<li><em><strong>(Q21) What is your command for this query?</strong></em></li>
<li><em><strong>(Q22) What is the output of the command?</strong></em></li>
</ul>
<hr>
<h3 id="vii-test-mongodb-index-performance">VII. Test MongoDB Index Performance</h3>
<p>In this part, you will test the performance of MongoDB by building different types of indexes and compare their performance.</p>
<ol>
<li>
<p>Download <a href="https://drive.google.com/open?id=1Cn_E45y0kVXZZRlb7BE9n6F7pwhrcPvZ">Tweets_100k.json</a>, upload the <code>.bz2</code> file to your <code>cs167</code> home directory. Decompress it by the following command:</p>
<pre class="hljs"><code><div>bzip2 -d Tweets_100k.json.bz2
</div></code></pre>
</li>
<li>
<p>Import <code>Tweets_100k.json</code> to MongoDB. You can use the command in Part III.1 (use <code>mongoimport</code>. You can specify the db name by using <code>--db</code> option).</p>
</li>
<li>
<p>You can list all databases by using:</p>
<pre class="hljs"><code><div>show dbs
</div></code></pre>
<p>You can switch to the database you just created for <code>Tweets_100k.json</code> by using:</p>
<pre class="hljs"><code><div>use [Your DB Name]
</div></code></pre>
</li>
<li>
<p>You can use the following command to show all indexes for current database:</p>
<pre class="hljs"><code><div>db.tweets.getIndexes()
</div></code></pre>
</li>
</ol>
<ul>
<li><em><strong>(Q23) Are there any existing indexes? Explain your answer.</strong></em></li>
</ul>
<ol start="5">
<li>
<p>You can use the following piece of code to find all tweets contain word <code>happy</code> using regex expression (case insensitive):</p>
<pre class="hljs"><code><div><span class="hljs-keyword">var</span> start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
<span class="hljs-keyword">var</span> result = db.tweets.find({
    <span class="hljs-attr">text</span>: { <span class="hljs-attr">$regex</span>: <span class="hljs-string">"\\bhappy\\b"</span>, <span class="hljs-attr">$options</span>: <span class="hljs-string">"i"</span> }
}).toArray();  
<span class="hljs-keyword">var</span> end = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
print(<span class="hljs-string">"Query time for regex search 'happy': "</span> + (end - start) + <span class="hljs-string">"ms"</span>);
print(<span class="hljs-string">"Total result count: "</span> + result.length);
</div></code></pre>
</li>
<li>
<p>Now, build a Text Index (a type of index in MongoDB for text) for <code>text</code> field in <code>tweets</code> collection by following command:</p>
<pre class="hljs"><code><div>db.tweets.createIndex({ <span class="hljs-string">"text"</span>: <span class="hljs-string">"text"</span> })
</div></code></pre>
</li>
<li>
<p>Write a query which use text index to find all tweets contain word happy, and measure its running time.</p>
</li>
</ol>
<ul>
<li><em><strong>(Q24) What's the running time of the second query? Comparing to Q23, it is faster or slower?</strong></em></li>
</ul>
<ol start="8">
<li>You can show the detailed explaination for query execution. For example, you can use the following code to show detailed information for running regex:<pre class="hljs"><code><div>db.tweets.find({
    <span class="hljs-attr">text</span>: { <span class="hljs-attr">$regex</span>: <span class="hljs-string">"\\bhappy\\b"</span>, <span class="hljs-attr">$options</span>: <span class="hljs-string">"i"</span> }  
}).explain(<span class="hljs-string">"executionStats"</span>) 
</div></code></pre>
You can find the following fields:<pre class="hljs"><code><div>winningPlan: {
    isCached: <span class="hljs-literal">false</span>,
    stage: 'COLLSCAN',
    filter: { text: { '$regex': '\\bhappy\\b', '$options': 'i' } },
    direction: 'forward'
},
rejectedPlans: []
...
executionStages: {
    isCached: <span class="hljs-literal">false</span>,
    stage: 'COLLSCAN',
    filter: { text: { '$regex': '\\bhappy\\b', '$options': 'i' } },
    nReturned: <span class="hljs-number">760</span>,
    executionTimeMillisEstimate: <span class="hljs-number">150</span>,
    works: <span class="hljs-number">100001</span>,
    advanced: <span class="hljs-number">760</span>,
    needTime: <span class="hljs-number">99240</span>,
    needYield: <span class="hljs-number">0</span>,
    saveState: <span class="hljs-number">8</span>,
    restoreState: <span class="hljs-number">8</span>,
    isEOF: <span class="hljs-number">1</span>,
    direction: 'forward',
    docsExamined: <span class="hljs-number">100000</span>
}
</div></code></pre>
</li>
</ol>
<ul>
<li><em><strong>(Q25) What do winningPlan and COLLSCAN mean?</strong></em></li>
</ul>
<ol start="9">
<li>Now, try <code>.explain(&quot;executionStats&quot;)</code> for your <code>text index-based</code> query.</li>
</ol>
<ul>
<li><em><strong>(Q26) What is the winningPlan? Did your query use the text index?</strong></em></li>
<li><em><strong>(Q27) You may notice that the nReturned of your query does not match the regex query. Do some explornations and explain why.</strong></em></li>
</ul>
<h3 id="viii-submission-2-minutes">VIII. Submission (2 minutes)</h3>
<ol>
<li>Write your answers using the <a href="CS167-Lab8-README.md">template <code>README.md</code></a> file.</li>
<li>Name your file <code>[UCRNetID]_lab7_README.md</code>, replace <code>[UCRNetID]</code> with your UCR Net ID.</li>
<li>Do not forget to include your information as you do in other labs.</li>
<li>No separate code is required for this lab.</li>
<li>Attach your generative AI conversations.</li>
</ol>
<h3 id="rubrics">Rubrics</h3>
<ul>
<li>
<p>Q/A: 14.5 points</p>
<ul>
<li>Q1, Q2, Q3, Q4: 0.5 points each</li>
<li>Q5: 1 point</li>
<li>Q6, Q7, Q8, Q9: 0.5 points each</li>
<li>Q10: 1 point</li>
<li>Q11: 0.5 points</li>
<li>Q12, Q13: 1 point each</li>
<li>Q14, Q15, Q16: 0.5 points each</li>
<li>Q17: 1 point</li>
<li>Q18: 0.5 point</li>
<li>Q19: 1 point</li>
<li>Q20: 0.5 points</li>
<li>Q21: 1 point</li>
<li>Q22: 0.5 points</li>
</ul>
</li>
<li>
<p>Proper Submission: 0.5 points</p>
</li>
</ul>

</body>

</html>